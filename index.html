<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'/>
  <title>SFU / Urban Strategies - Active Transportation Survey Results</title>
  <meta name = 'viewport' content='initial-scale=1, maximum-scale=1,user-scalable=no' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

</head>
<body>
<!--map object -->

<!--zoning navigation menu -->
<nav id='Menu'>
	<p id="Menu-Explanation"> <b>Layers</b> <br> Click buttons to toggle on/off</p>
</nav>

<div id='map'></div>

<style>
/*map style*/
#map {
      position:absolute;
      top:0;
      bottom:0;
      width:100%;
      z-index: 0;
     }
 /*popups - divs are set dynamically in the toggle functions below. This is why they are not seen in the <body> above */
    .mapboxgl-popup {
     max-width: 350px;
     font: 12px/20px 'Helvetica Neue', sans-serif;
    }
     html .mapboxgl-popup-content {
     padding: 0px;
     -webkit-box-shadow: 0 0 1px 1px rgba(0,0,0,0.2);
     box-shadow: 0 0 1px 1px rgba(0,0,0,0.2);
     opacity: 0.95;
     }
     .mapboxgl-popup h3 {
     	color: #000000;
     	font-size: 16px;
     	font-weight: bold;
     	padding-left: 15px;
     	padding-right: 25px;
     }
     .mapboxgl-popup p {
     	color: #000000;
     	font-size: 13px;
     	font-weight: none;
     	padding-left: 15px;
     	padding-right: 25px;
     }
#Menu {
      background-color: rgba(78,78,78,0.85);
      position: absolute;
      color: rgba(255,255,255,0.75);
      display: block;
      margin: 5px;
      padding-top: 10px;
      padding-bottom: 10px;
      z-index: 1;
      top: 100px;
      right: 25px;
      border-radius: 10px;
      width: 250px;
      border: 1px solid rgba(0,0,0,0.4);
      font: 15px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
      color: rgba(255,255,255,0.75);
      z-index: 2;
      }
#Menu-Explanation {
      display: block;
      margin: 5px;
      padding: 5px;
      text-decoration: none;
      border-top: 1px solid rgba(0,0,0,0.25);
      text-align: center;
      color: rgba(255,255,255,0.75);
      z-index: 3;
      }
       /*zoning menu "buttons" style. See colour specifications below. Also, see toggle javascript functions below*/
#Menu a {
      display: block;
      margin: 5px;
      padding: 5px;
      text-decoration: none;
      border-bottom: 1px solid rgba(0,0,0,0.25);
      text-align: center;
      color: rgba(255,255,255,0.75);
      z-index: 3;
      }
#Menu a:last-child {
      border: none;
      }
#Menu a:hover {
      background-color: #FFFFFF;
      opacity: 0.75;
      color: #404040;
      font: bold;
      }
/*zoning menu "buttons" colours. See toggle javascript functions below*/
#Menu a.Combination of Cycling and Public Transit  {
      background-color: #DEDEDE;
      color: #ffffff;
      }
#Menu a.Active Transportation all the way  {
      background-color: #DEDEDE;
      color: #ffffff;
      }
/*hover styles for toggle buttons*/
#Menu a.active {
      background: #DEDEDE;
      }
html .mapboxgl-ctrl-top-right {
      top: 50px;
      right: 85px;
      }
html .mapboxgl-ctrl-group{
      width: 250px;
      margin: 10px 0px;
      border-radius: 0;
      -moz-box-shadow: 0px 0px 2px rgba(0,0,0,0.1);
      -webkit-box-shadow: 0px 0px 2px rgba(0,0,0,0.1);
      box-shadow: none;
      overflow: hidden;
      background: transparent;
      z-index:4;
      }
html .mapboxgl-ctrl-group button {
      width: 35px;
      height: 35px;
      display: inline-block;
      padding: 0;
      outline: none;
      border: none;
      border-bottom: none;
      box-sizing: border-box;
      cursor: pointer;
      background-color: rgba(107,107,107,0.85);
      border-radius: 25px;
      margin: 0 7px 0 0;
      top: 0px;
      float: right;
      }
</style>


<script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoic3RvcnByaW1lIiwiYSI6InR6YWtmU2MifQ.mzm3c3_RSxKKc5MgUe0Fig';
    var map = new mapboxgl.Map({
      container: 'map', //container id
      style: 'mapbox://styles/storprime/cjrwm2mkv0d281fofa2ijq9cj', //new satellite image updated
      center: [-122.917432,49.278018],
      zoom: 14, //starting zoom
      bearing: 0, // starting direction
      pitch: 0, //starting pitch
    });
    map.on('style.load', function() {
      // zoom and rotation controls for the <map>
        map.addControl (new mapboxgl.NavigationControl());
        map.setLight({
          'anchor':'map',
          'color':'white',
          'intensity': 0.40,
          'position': [45,45,45,],
        });
        //add sources
        map.addSource('Combination_Cycling_and_Publi-dtn92o', {
          type: "vector",
          url: "mapbox://storprime.1czgylnn"
        });

        map.addSource('Active_Transportation-4i24hx', {
          type: "vector",
          url: "mapbox://storprime.2wmqmen9"
        });

        map.addSource('Hovers-b8dflc', {
          type: "vector",
          url: "mapbox://storprime.29umw5fx"
        });




        map.addLayer({
          'id': 'Combination of Cycling and Public Transit',
          'type':'line',
          'source': 'Combination_Cycling_and_Publi-dtn92o',
          'source-layer': 'Combination_Cycling_and_Publi-dtn92o',
          'layout': {
            		visibility: 'none'
          	},
          'paint': {
            'line-color':  '#FFB100',
            'line-width': 3
          },
        })

        map.addLayer({
          'id': 'Active Transportation all the way',
          'type':'line',
          'source': 'Active_Transportation-4i24hx',
          'source-layer': 'Active_Transportation-4i24hx',
          'layout': {
            		visibility: 'none'
          	},
          'paint': {
            'line-color': '#FF5900',
            'line-width': 3
          },
        })

        map.addLayer({
          'id': 'Hovers',
          'type':'line',
          'source': 'Hovers-b8dflc',
          'source-layer': 'Hovers-b8dflc',
          'layout': {
            		visibility: 'none'
          	},
          'paint': {
            'line-color': '#FFFFFF',
            'line-width': 6,
            'line-opacity': 0.25
          },
        })


  });
//set the filter function for toggleableZoningLayerIds
/* zoning categories popups*/
map.on ('click', function (e){
/* query the feature that is clicked*/
var features = map.queryRenderedFeatures(e.point, { layers: ['Combination of Cycling and Public Transit','Active Transportation all the way']}); //THIS NEEDS TO BE THE ACTIVE LAYER
/* if the queried features array has objects  - has length - then return then return*/
if (!features.length){
		return;}
/* capture in a new variable the first feature clicked*/
var feature = features[0]; //key to the interactive opacity change
/* set a new popup object at the clicked point*/
var popup = new mapboxgl.Popup()
.setLngLat(map.unproject(e.point))
/* dynamically create the html content of each popup based on concatenating pre-written html and certain attribute / property fields */
.setHTML('<h3 class=Variable Title>Are you a?:</h3> <p class=value>'+feature.properties.usertype+'</p>'
+'<h3 class=Variable Title>Comment</h3> <p class=value>'+feature.properties.routes_why+'</p>'
+'<h3 class=Variable Title>How do you get to campus?:</h3> <p class=value>'+feature.properties.Transportation_Mode+'</p>'
+'<h3 class=Variable Title>When do you arrive on campus?</h3> <p class=value>'+feature.properties.Arrival_Time+'</p>'
+'<h3 class=Variable Title>When do you leave campus?</h3> <p class=value>'+feature.properties.Departure_Time+'</p>'
)//set the click box html
/* add popup to the map object*/
.addTo(map);
});
/*set cursor style on hover for buildings*/
map.on('mousemove', function (e) {
  var features = map.queryRenderedFeatures(e.point, { layers: ['Combination of Cycling and Public Transit','Active Transportation all the way'] }); //THIS NEEDS TO BE THE ACTIVE LAYER
  map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';
  });
  /*set DA highlight on hover*/
  map.on('mousemove', function (e) {
  	var hovFeatures = map.queryRenderedFeatures(e.point, {layers: ['Hovers']});
  	if (hovFeatures.length) {
  		map.setFilter('Hovers', ["==", "Source",hovFeatures[0].properties.Source]);}
  	else {
  		map.setFilter('Hovers', ["==", "Source", ""]);
  		}
  });
  /*dynamically create buttons for each layer.*/
var toggleableMapLayerIds = ['Combination of Cycling and Public Transit','Active Transportation all the way'];
for (var i = 0; i < toggleableMapLayerIds.length; i++){
  var id = toggleableMapLayerIds[i];
  var link = document.createElement('a');
  link.href = '#';
  link.className = id;
  link.textContent = id;
  link.onclick = function (e) {
  	var clickedLayer = this.textContent;
  	e.preventDefault();
  	e.stopPropagation();
  	/*find out if the layer that the button references is visible or not. If not visible, on click make it visible and vice versa*/
  	var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
  	if (visibility === 'visible') {
  		map.setLayoutProperty(clickedLayer, 'visibility', 'none');
  		this.className = '';}
  	else {
  		this.className = clickedLayer;
  		map.setLayoutProperty(clickedLayer, 'visibility','visible');
  		};
  	};
    /*dynamically assign html to the "link" - the toggle button*/
    var mapLayers = document.getElementById('Menu');
    mapLayers.appendChild(link);
};
</script>

</body>
</html>
